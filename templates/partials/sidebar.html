<!-- Sidebar with exact styling from /hub -->
<div id="sidebar" class="sidebar">
    <!-- Header -->
    <div class="sidebar-header">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500"></div>
            <div>
                <div class="sidebar-title">Eraya Ops</div>
                <div class="sidebar-subtitle">
                    Admin Access
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 overflow-y-auto py-4">
        <!-- Main Menu -->
        {% for item in NAV_ITEMS %}
            {% if item.type == "separator" %}
                <div class="sidebar-separator">{{ item.name }}</div>
            {% else %}
                <a href="{{ item.url }}" class="sidebar-item {{ 'active' if request.url.path == item.url }} {{ 'locked' if not item.active }}">
                    <div class="sidebar-icon">{{ item.icon }}</div>
                    <div class="sidebar-text">{{ item.name }}</div>
                    {% if item.badge %}
                        <span class="sidebar-badge">{{ item.badge }}</span>
                        <span class="sidebar-lock">üîí</span>
                    {% endif %}
                </a>
            {% endif %}
        {% endfor %}
    </nav>

    <!-- Bottom Items -->
    <div class="sidebar-bottom">
        <a href="/" class="sidebar-item">
            <div class="sidebar-icon">üè†</div>
            <div class="sidebar-text">Home</div>
        </a>
        <div class="sidebar-item" onclick="handleLogoutClick()" style="cursor: pointer;" title="Logout" id="logoutBtn">
            <div class="sidebar-icon">üö™</div>
            <div class="sidebar-text">Logout</div>
        </div>

    </div>
</div>

<!-- Mobile Toggle -->
<button id="sidebarToggle" class="md:hidden fixed top-4 left-4 z-40 p-2 rounded-lg bg-slate-800 text-white">
    <span class="text-lg">‚ü®</span>
</button>

<!-- Mobile Overlay -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden" onclick="toggleSidebar()"></div>

<!-- Logout Function Script -->
<script>
// Handle logout click with error checking
function handleLogoutClick() {
    console.log('Logout button clicked');
    
    if (typeof logout === 'function') {
        console.log('Calling logout function...');
        logout();
    } else {
        console.error('Logout function not available, trying direct API call...');
        // Fallback: direct API call
        directLogout();
    }
}

// Direct logout function as fallback
async function directLogout() {
    const logoutBtn = document.getElementById('logoutBtn');
    
    try {
        // Show loading state
        if (logoutBtn) {
            logoutBtn.style.opacity = '0.6';
            logoutBtn.style.pointerEvents = 'none';
            const iconElement = logoutBtn.querySelector('.sidebar-icon');
            const textElement = logoutBtn.querySelector('.sidebar-text');
            if (iconElement) iconElement.textContent = '‚è≥';
            if (textElement) textElement.textContent = 'Logging out...';
        }
        
        console.log('Making direct logout API call...');
        
        const response = await fetch('/api/auth/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        });
        
        console.log('Logout API response:', response.status, response.statusText);
        
        if (response.ok) {
            // Clear any stored session data
            localStorage.removeItem('session_id');
            sessionStorage.clear();
            
            // Show success state briefly
            if (logoutBtn) {
                const iconElement = logoutBtn.querySelector('.sidebar-icon');
                const textElement = logoutBtn.querySelector('.sidebar-text');
                if (iconElement) iconElement.textContent = '‚úì';
                if (textElement) textElement.textContent = 'Success!';
            }
            
            console.log('Logout successful');
            
            // Redirect to login page after brief delay
            setTimeout(() => {
                window.location.href = '/login';
            }, 500);
        } else {
            console.error('Logout failed');
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('Logout error:', error);
        window.location.href = '/login';
    }
}

// Main logout function - ensure it's available
async function logout() {
    const logoutBtn = document.getElementById('logoutBtn');
    
    try {
        // Show loading state
        if (logoutBtn) {
            logoutBtn.style.opacity = '0.6';
            logoutBtn.style.pointerEvents = 'none';
            const iconElement = logoutBtn.querySelector('.sidebar-icon');
            const textElement = logoutBtn.querySelector('.sidebar-text');
            if (iconElement) iconElement.textContent = '‚è≥';
            if (textElement) textElement.textContent = 'Logging out...';
        }
        
        console.log('Logout function called, making API request...');
        
        const response = await fetch('/api/auth/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        });
        
        console.log('Logout API response:', response.status, response.statusText);
        
        if (response.ok) {
            // Clear any stored session data
            localStorage.removeItem('session_id');
            sessionStorage.clear();
            
            // Show success state briefly
            if (logoutBtn) {
                const iconElement = logoutBtn.querySelector('.sidebar-icon');
                const textElement = logoutBtn.querySelector('.sidebar-text');
                if (iconElement) iconElement.textContent = '‚úì';
                if (textElement) textElement.textContent = 'Success!';
            }
            
            // Show logout message
            console.log('Logout successful');
            
            // Redirect to login page after brief delay
            setTimeout(() => {
                window.location.href = '/login';
            }, 500);
        } else {
            console.error('Logout failed');
            // Still redirect to login page even if logout API fails
            window.location.href = '/login';
        }
    } catch (error) {
        console.error('Logout error:', error);
        // Still redirect to login page even if there's an error
        window.location.href = '/login';
    }
}

// Test if logout function is available
console.log('Logout function loaded, available:', typeof logout);
</script>